<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>
   xhwicap.c File Reference
</title>
<link href="$DriverApiDocsCssPath" rel="stylesheet" type="text/css">
</head>
<h3 class="PageHeader">Xilinx Processor IP Library</h3>
<hl>Software Drivers</hl>
<hr class="whs1">
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>xhwicap.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the functions of the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> driver. See xhwicap.h for a detailed description of the driver.<p>
<dl compact><dt><b>Note:</b></dt><dd></dd></dl>
Virtex4, Virtex5, Virtex6, Spartan6, 7 series and Zynq devices are supported.<p>
In a Zynq device the ICAP needs to be selected using the XDcfg_SelectIcapInterface API of the DevCfg driver (clear the PCAP_PR bit of Control register in the Device Config Interface) before it can be accessed using the HwIcap.<p>
<pre>
 MODIFICATION HISTORY:</pre><p>
<pre> Ver   Who  Date      Changes
 ----- ---- -------- -------------------------------------------------------
 2.00a sv   09/11/07  Initial version.
 2.01a ecm  04/08/08  Updated data structures to include the V5FXT parts.
 3.00a sv   11/28/08  Added the API for initiating Abort while reading/writing
		       from the ICAP.
 4.00a hvm  12/1/09   Added support for V6 and updated with HAL phase 1
		       modifications
 5.00a hvm  04/02/10  Added support for S6 device.
 5.01a hvm  07/06/10  In XHwIcap_DeviceRead function, a read bit mask
		       verification is added after all the data bytes are read
		       from READ FIFO.The Verification of the read bit mask
		       at the begining of reading of bytes is removed.
 5.03a hvm  15/4/11   Updated with V6 CXT device definitions.
 6.00a hvm  08/01/11  Added support for K7 devices.
 7.00a bss  03/14/12  Added support for 8/16/32 ICAP Data Widths - CR 620085
		       Added support for Lite Mode(no Write FIFO) - CR 601748
		       Added Virtex 7, Artix 7 and Zynq Idcodes in Device look
		        up table - CR 647140, CR 643295
 8.01a bss  04/18/13  Updated to fix compiler warnings. CR#704814
 9.0   bss  02/20/14  Updated to support Kintex8, kintexu and virtex72000T
	 		family devices.
 </pre> 
<p>
<code>#include &lt;xil_types.h&gt;</code><br>
<code>#include &lt;xil_assert.h&gt;</code><br>
<code>#include &quot;xhwicap.h&quot;</code><br>
<code>#include &quot;xparameters.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#f045fb52eb875b8f00cec7c7c102535a">XHwIcap_CfgInitialize</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr, <a class="el" href="struct_x_hw_icap___config.html">XHwIcap_Config</a> *ConfigPtr, u32 EffectiveAddr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#a0b4509525e91175d228fbcb4e366a02">XHwIcap_DeviceWrite</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr, u32 *FrameBuffer, u32 NumWords)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#55233b60dce180144085382015d8e3a1">XHwIcap_DeviceRead</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr, u32 *FrameBuffer, u32 NumWords)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#4f66b4d58947c66fac8536a3036b4bdb">XHwIcap_Reset</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#5ea7f342f5445b9c6ecde001133d61be">XHwIcap_FlushFifo</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xhwicap_8c.html#87689e05cf91a9d7eb584198a178c39c">XHwIcap_Abort</a> (<a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *InstancePtr)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="87689e05cf91a9d7eb584198a178c39c"></a><!-- doxytag: member="xhwicap.c::XHwIcap_Abort" ref="87689e05cf91a9d7eb584198a178c39c" args="(XHwIcap *InstancePtr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XHwIcap_Abort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InstancePtr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function initiates the Abort Sequence by setting the Abort bit in the control register.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="f045fb52eb875b8f00cec7c7c102535a"></a><!-- doxytag: member="xhwicap.c::XHwIcap_CfgInitialize" ref="f045fb52eb875b8f00cec7c7c102535a" args="(XHwIcap *InstancePtr, XHwIcap_Config *ConfigPtr, u32 EffectiveAddr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XHwIcap_CfgInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct_x_hw_icap___config.html">XHwIcap_Config</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ConfigPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveAddr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function initializes a specific <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance. The IDCODE is read from the FPGA and based on the IDCODE the information about the resources in the FPGA is filled in the instance structure.<p>
The HwIcap device will be in put in a reset state before exiting this function.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ConfigPtr</em>&nbsp;</td><td>points to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> device configuration structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>EffectiveAddr</em>&nbsp;</td><td>is the device base address in the virtual memory address space. If the address translation is not used then the physical address is passed. Unexpected errors may occur if the address mapping is changed after this function is invoked.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS else XST_FAILURE</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None.</dd></dl>
Set IcapWidth<p>
Set IsLiteMode     </td>
  </tr>
</table>
<a class="anchor" name="55233b60dce180144085382015d8e3a1"></a><!-- doxytag: member="xhwicap.c::XHwIcap_DeviceRead" ref="55233b60dce180144085382015d8e3a1" args="(XHwIcap *InstancePtr, u32 *FrameBuffer, u32 NumWords)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XHwIcap_DeviceRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32 *&nbsp;</td>
          <td class="mdname" nowrap> <em>FrameBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32&nbsp;</td>
          <td class="mdname" nowrap> <em>NumWords</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function reads the specified number of words from the ICAP device in the polled mode. Interrupt mode is not supported in reading data from the ICAP device.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FrameBuffer</em>&nbsp;</td><td>is a pointer to the memory where the frame read from the ICAP device is stored. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NumWords</em>&nbsp;</td><td>is the number of words (16 bit for S6 and 32 bit for all other devices) to write to the ICAP device.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the specified number of words have been read from the ICAP device</li><li>XST_FAILURE if the device is busy with the last Read/Write or if the requested number of words have not been read from the ICAP device, or there is a timeout.</li></ul>
</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This is a blocking function. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a0b4509525e91175d228fbcb4e366a02"></a><!-- doxytag: member="xhwicap.c::XHwIcap_DeviceWrite" ref="a0b4509525e91175d228fbcb4e366a02" args="(XHwIcap *InstancePtr, u32 *FrameBuffer, u32 NumWords)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XHwIcap_DeviceWrite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32 *&nbsp;</td>
          <td class="mdname" nowrap> <em>FrameBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32&nbsp;</td>
          <td class="mdname" nowrap> <em>NumWords</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function writes the given user data to the Write FIFO in both the polled mode and the interrupt mode and starts the transfer of the data to the ICAP device.<p>
In the polled mode, this function will write the specified number of words into the FIFO before returning.<p>
In the interrupt mode, this function will write the words upto the size of the Write FIFO and starts the transfer, then subsequent transfer of the data is performed by the interrupt service routine until the entire buffer has been transferred. The status callback function is called when the entire buffer has been sent. In order to use interrupts, it is necessary for the user to connect the driver interrupt handler, <a class="el" href="xhwicap__intr_8c.html#48881e78c38a9f3c990826cbb9479d2f">XHwIcap_IntrHandler()</a>, to the interrupt system of the application and enable the interrupts associated with the Write FIFO. The user has to enable the interrupts each time this function is called using the XHwIcap_IntrEnable macro.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FrameBuffer</em>&nbsp;</td><td>is a pointer to the data to be written to the ICAP device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NumWords</em>&nbsp;</td><td>is the number of words (16 bit for S6 and 32 bit for all other devices)to write to the ICAP device.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>XST_SUCCESS or XST_FAILURE</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This function is a blocking for the polled mode of operation and is non-blocking for the interrupt mode of operation. Use the function XHwIcap_DeviceWriteFrame for writing a frame of data to the ICAP device.</dd></dl>
Icap Width of 32 does not use Fifo but declared to overcome compilation error. Size of 4 is used to overcome compiler warnings     </td>
  </tr>
</table>
<a class="anchor" name="5ea7f342f5445b9c6ecde001133d61be"></a><!-- doxytag: member="xhwicap.c::XHwIcap_FlushFifo" ref="5ea7f342f5445b9c6ecde001133d61be" args="(XHwIcap *InstancePtr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XHwIcap_FlushFifo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InstancePtr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function flushes the FIFOs in the device.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="4f66b4d58947c66fac8536a3036b4bdb"></a><!-- doxytag: member="xhwicap.c::XHwIcap_Reset" ref="4f66b4d58947c66fac8536a3036b4bdb" args="(XHwIcap *InstancePtr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XHwIcap_Reset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_hw_icap.html">XHwIcap</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>InstancePtr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function forces the software reset of the complete HWICAP device. All the registers will return to the default value and the FIFO is also flushed as a part of this software reset.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_hw_icap.html">XHwIcap</a> instance.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None. </dd></dl>
    </td>
  </tr>
</table>
Copyright @ 1995-2014 Xilinx, Inc. All rights reserved. 
